# منطق إدارة المستأجرين (Tenant Management Logic)

## نظرة عامة

هناك حالتان للمستأجرين في النظام:

### الحالة 1: مستأجر لديه حساب في الموقع (Tenant with User Account)
- المستأجر سجل حساب في الموقع مع `user_type = 'tenant'`
- **يتم إضافته في جدول `tenants`** مع `user_id` محدد
- يمكنه تسجيل الدخول واستئجار العقارات بنفسه
- له profile في جدول `users` وفي جدول `tenants`

### الحالة 2: مستأجر بدون حساب (Tenant without User Account)
- المالك يضيف مستأجر من صفحة "إضافة مستأجر"
- **يتم إضافته أيضاً في جدول `tenants`** مع `user_id = NULL`
- ليس لديه حساب، فقط معلوماته موجودة في جدول `tenants`
- لا يمكنه تسجيل الدخول
- المالك يدير عقوده

## المنطق الصحيح

### جدول `tenants`
- **يحتوي على جميع المستأجرين** (مع أو بدون حساب)
- `user_id`:
  - **NULL** إذا لم يكن لديه حساب (أضافه المالك)
  - **محدد** إذا كان لديه حساب (سجل في الموقع)

### جدول `contracts`
- يستخدم `tenant_id` للإشارة إلى جدول `tenants`
- الحقول القديمة `tenant_name`, `tenant_email`, `tenant_phone` موجودة فقط للتوافق مع الإصدارات السابقة
- **يجب استخدام `tenant_id` دائماً** عند إنشاء عقد جديد

## سيناريوهات الاستخدام

### السيناريو 1: مستأجر لديه حساب يستأجر عقار
1. المستأجر يسجل حساب (`user_type = 'tenant'`)
2. يتم إنشاء Tenant في جدول `tenants` مع `user_id`
3. المستأجر يستأجر عقار → يتم إنشاء Contract مع `tenant_id`

### السيناريو 2: مالك يضيف مستأجر بدون حساب
1. المالك يضيف مستأجر من صفحة "إضافة مستأجر"
2. يتم إنشاء Tenant في جدول `tenants` مع `user_id = NULL`
3. يتم إنشاء Contract مع `tenant_id` يشير إلى Tenant

### السيناريو 3: مستأجر لديه حساب يتم إضافته من قبل المالك
1. المالك يضيف مستأجر برقم جوال موجود
2. النظام يجد Tenant الموجود برقم الجوال
3. إذا كان Tenant لديه `user_id` → يستخدمه
4. إذا لم يكن لديه `user_id` → يضيف `user_id` إذا تم العثور على User

## الفوائد

✅ **قاعدة بيانات موحدة**: جميع المستأجرين في مكان واحد
✅ **إمكانية الترقية**: مستأجر بدون حساب يمكن أن يسجل لاحقاً
✅ **إحصائيات كاملة**: يمكن رؤية جميع المستأجرين بغض النظر عن وجود حساب
✅ **تجنب التكرار**: إذا كان نفس المستأجر يستأجر عقارات متعددة، يتم استخدام نفس Tenant
